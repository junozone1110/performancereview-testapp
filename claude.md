# 従業員目標設定・振り返り・評価システム

## プロジェクト概要

従業員の目標設定・振り返り・評価をスクラッチで構築するシステム。現行SaaS（カオナビ）からの移行を目指す。

- **利用規模**: 従業員500名、管理職50名
- **評価サイクル**: 半期ごと（上期・下期）

## 技術スタック

| レイヤー | 技術 |
|----------|------|
| フロントエンド | Next.js 14 (App Router) + TypeScript |
| UIライブラリ | **Abukumaデザインシステム** (@giftee/abukuma-react, @giftee/abukuma-css) |
| バックエンド | Next.js API Routes |
| ORM | Prisma |
| データベース | PostgreSQL (Supabase) |
| 認証 | NextAuth.js (Google Workspace SSO) |

## ドキュメント構成

```
docs/
├── requirements.md        # 要件定義書
└── implementation-plan.md # 実行計画書
```

## 重要ルール

### 1. 仕様変更時のドキュメント更新

**実装中に仕様変更が発生した場合、必ず以下を実行すること:**

1. **要件定義書の更新** (`docs/requirements.md`)
   - 変更箇所を特定し、該当セクションを更新
   - 改訂履歴に変更内容を追記

2. **実行計画書の更新** (`docs/implementation-plan.md`)
   - 影響を受けるタスクやスキーマを更新

3. **変更の報告**
   - 変更内容をユーザーに報告し、確認を取る

```
例: 目標の最大数が6個から8個に変更された場合
1. requirements.md の「2.2 目標設定ルール」を更新
2. requirements.md の「改訂履歴」に記録
3. implementation-plan.md のPrismaスキーマを確認・更新
4. ユーザーに変更を報告
```

### 2. Abukumaデザインシステムの使用

フロントエンド実装時は**Abukumaデザインシステムを最優先**で使用すること。

- コンポーネント実装前に `list_react_components` で既存コンポーネントを確認
- CSSユーティリティは `ab-` プレフィックスを使用
- 独自スタイルは最終手段（Abukuma → style属性 → カスタムCSS の順で検討）

### 3. コーディング規約

#### Server Component vs Client Component

```tsx
// Server Component（デフォルト）- データ取得に使用
export default async function Page() {
  const data = await prisma.findMany();
  return <ClientComponent data={data} />;
}

// Client Component - インタラクションに使用
'use client';
export function ClientComponent({ data }) { ... }
```

#### ディレクトリ構成

```
app/
├── (auth)/           # 認証関連
├── (employee)/       # 従業員向け
├── (manager)/        # 管理職向け
├── (hr)/             # HR向け
└── api/              # API Routes
```

### 4. 権限とワークフロー

#### 権限（3種類）

| 権限 | 対象範囲 |
|------|----------|
| 従業員 | 自分のシートのみ |
| 管理職 | 管理対象従業員 + 自分 |
| HR | 全従業員 |

#### ワークフロー（8フェーズ）

```
① 目標入力 → ② 目標確定 → ③ 自己評価入力 → ④ 自己評価確定
→ ⑤ 上長評価入力 → ⑥ 上長評価確定 → ⑦ HR判断入力 → ⑧ 最終確定
```

#### 閲覧権限

- **上長評価・Mgr判断・HR判断は従業員には非表示**
- HR判断は管理職には表示

## 主要な画面

| 画面 | 説明 |
|------|------|
| 評価シート (S-1) | メイン画面。権限・フェーズで項目を制御 |
| マイページ (L-1) | 従業員用。自分のシート一覧 |
| 部下一覧 (L-2) | 管理職用。管理対象従業員一覧 |
| 全従業員一覧 (L-3) | HR用。検索・フィルタ |
| 評価期間管理 (H-1) | HR用。期間作成、フェーズ切替 |
| 組織インポート (H-2) | HR用。CSVインポート |

## 評価項目サマリ

### 目標ごと（最大6個）

- 目標概要・詳細・達成基準・ウェイト（合計100%、1目標最大40%）
- 自己評価: 成果振り返り、コンピテンシー振り返り（3項目）、評価ランク
- 上長評価: コメント、評価ランク

### 総評

- 平均点（自動計算: Σ成果評価数値×ウェイト）
- コンピテンシーレベル
- Mgr判断: 処置（昇給/現状維持/降給）、昇給額、等級
- HR判断: 最終処置、最終昇給額、最終等級

### 評価段階

| 種別 | 段階 |
|------|------|
| 成果評価 | SS(5), S(4), A(3), B(2), C(1) |
| コンピテンシー | 2.0, 2.5, 3.0-, 3.0, 3.5, 4.0 |
| 等級 | G1〜G7 |

## 外部連携

- **SmartHR**: 従業員・組織データのインポート（モックアップ段階はCSV）
- **Google Workspace**: SSO認証

## Git/GitHub運用ルール

### 5. Issue駆動開発

**すべての変更はIssueを起点とすること:**

1. **Issue作成**
   - 作業開始前に必ずGitHub Issueを作成
   - Issueには目的・背景・完了条件を明記

2. **ブランチ作成**
   - Issue番号を含むブランチ名を使用
   - 命名規則: `feature/#<issue番号>-<簡潔な説明>` または `fix/#<issue番号>-<簡潔な説明>`
   - 例: `feature/#1-initial-setup`, `fix/#23-login-error`

3. **Pull Request作成**
   - PRタイトルまたは本文でIssueを参照（`Closes #<issue番号>` または `Fixes #<issue番号>`）
   - これによりPRマージ時にIssueが自動クローズされる

4. **直接mainへのpush禁止**
   - 必ずfeature/fixブランチを作成しPR経由でマージ

```
例: 初期セットアップの場合
1. Issue #1「プロジェクト初期セットアップ」を作成
2. ブランチ `feature/#1-initial-setup` を作成
3. コミット & プッシュ
4. PR作成時に「Closes #1」を本文に記載
5. PRマージでIssue自動クローズ
```

## 開発時の注意事項

1. **過度な抽象化を避ける** - シンプルな実装を優先
2. **既存パターンを踏襲** - 新規実装前に既存コードを確認
3. **権限チェックを忘れない** - 全APIエンドポイントで権限確認
4. **ワークフロー制御** - フェーズに応じた入力可否を正しく実装
